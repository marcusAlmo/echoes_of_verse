<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echoes of Verse | Literary Database</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* Custom Font Assignments */
        body {
            font-family: 'Montserrat', sans-serif;
            transition: background 1.5s ease, color 0.5s ease;
        }
        .serif-font {
            font-family: 'Cormorant Garamond', serif;
        }

        /* --- IMMERSIVE BACKGROUND STATES (JOURNEY MODE) --- */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Default Ambient - Darkened for better contrast */
        .ambient-default { background: linear-gradient(-45deg, #c4e0f5, #d8b4fe, #cbd5e1); background-size: 400% 400%; animation: gradientBG 15s ease infinite; }
        .dark .ambient-default { background: linear-gradient(-45deg, #0f172a, #1e1b4b, #020617); background-size: 400% 400%; animation: gradientBG 15s ease infinite; }

        /* Specific Moods for Stanzas */
        .mood-ice { background: linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%); }
        .dark .mood-ice { background: linear-gradient(to top, #1e3c72 0%, #2a5298 100%); }
        .mood-pain { background: linear-gradient(120deg, #fccb90 0%, #d57eeb 100%); }
        .dark .mood-pain { background: linear-gradient(120deg, #4c1d1d 0%, #3f2b96 100%); }
        .mood-light { background: linear-gradient(120deg, #f6d365 0%, #fda085 100%); }
        .dark .mood-light { background: linear-gradient(120deg, #5f4a0a 0%, #753a2d 100%); }
        .mood-void { background: linear-gradient(to top, #dfe9f3 0%, white 100%); }
        .dark .mood-void { background: linear-gradient(to top, #000000 0%, #434343 100%); }
        .mood-deprivation { background: linear-gradient(to right, #868f96 0%, #596164 100%); }
        .dark .mood-deprivation { background: linear-gradient(to right, #232526 0%, #414345 100%); }
        .mood-silver { background: linear-gradient(to top, #accbee 0%, #e7f0fd 100%); }
        .dark .mood-silver { background: linear-gradient(to top, #191c20 0%, #2c3e50 100%); }
        .mood-love { background: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%); }
        .dark .mood-love { background: linear-gradient(to right, #521818 0%, #701c1c 100%); }


        /* Glassmorphism Cards - Increased Opacity for Light Mode */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85); /* Increased from 0.65 to 0.85 for readability */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            transition: all 0.5s ease;
        }
        .dark .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            color: #e2e8f0;
        }

        /* Transition Utilities */
        .fade-in { animation: fadeIn 0.8s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Highlight Logic for 'Resonance Mode' */
        .highlight-word { transition: all 0.5s ease; display: inline-block; }
        .resonance-active .poem-text { color: rgba(0,0,0,0.1); }
        .dark .resonance-active .poem-text { color: rgba(255,255,255,0.1); }
        .resonance-active .highlight-word { color: #4f46e5; font-weight: 600; transform: scale(1.1); text-shadow: 0 0 10px rgba(79, 70, 229, 0.2); }
        .dark .resonance-active .highlight-word { color: #818cf8; text-shadow: 0 0 15px rgba(129, 140, 248, 0.5); }

        /* Read-Along Mode Styles */
        .guide-note {
            font-size: 0.6em;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #ec4899; /* Pink-500 */
            vertical-align: super;
            margin-right: 0.2em;
            font-weight: bold;
        }
        .dark .guide-note { color: #f472b6; }
        .stress-mark {
            border-bottom: 2px solid #f59e0b; /* Amber-500 */
            font-weight: 600;
        }
        
        /* Journey Mode Specifics */
        .journey-card {
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .journey-card:hover { transform: scale(1.02); }
        .journey-nav-hint { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* Particle Animation Defaults */
        .anim-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden; }
        .anim-icon { position: absolute; opacity: 0; animation-timing-function: linear; }
        
        /* Updated Footprint Trail Animation */
        .anim-footprint {
            color: #60a5fa; /* Slightly darker blue for light mode visibility */
            font-size: 2.5rem; 
            opacity: 0;
            animation: walkTrail 8s forwards;
        }
        .dark .anim-footprint { color: #1e3a8a; opacity: 0; }
        
        @keyframes walkTrail {
            0% { opacity: 0; transform: scale(0.8); }
            10% { opacity: 0.5; transform: scale(1); }
            60% { opacity: 0.3; }
            100% { opacity: 0; transform: scale(0.9); }
        }

        .anim-sparkle { color: #fca5a5; font-size: 1.5rem; animation: riseUp 8s infinite ease-in-out; }
        .dark .anim-sparkle { color: #9f1239; opacity: 0.3; }
        @keyframes riseUp { 
            0% { transform: translateY(110vh) scale(0.5); opacity: 0; } 
            50% { opacity: 0.6; transform: translateY(50vh) scale(1.2); } 
            100% { transform: translateY(-10vh) scale(0.5); opacity: 0; } 
        }

        /* Modal Styles */
        .modal-overlay { opacity: 0; pointer-events: none; transition: all 0.4s ease; }
        .modal-open { opacity: 1; pointer-events: auto; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
    </style>
</head>
<body id="main-body" class="ambient-default min-h-screen text-slate-900 dark:text-slate-200 overflow-x-hidden selection:bg-indigo-100 dark:selection:bg-indigo-900 selection:text-indigo-800 dark:selection:text-indigo-200">

    <!-- Dynamic Animation Layer -->
    <div id="anim-layer" class="anim-container"></div>

    <!-- Intro Modal (Appears Once) -->
    <div id="intro-modal" class="modal-overlay fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-md"></div>
        <div class="glass-panel relative z-10 w-full max-w-2xl rounded-2xl p-8 md:p-12 transform scale-95 transition-transform duration-500 shadow-2xl text-center">
            
            <p class="text-xs uppercase tracking-[0.4em] text-indigo-800 dark:text-indigo-300 mb-4 opacity-90 font-bold">Welcome to</p>
            <h1 class="serif-font text-5xl md:text-6xl text-slate-900 dark:text-white mb-6">Whispers of Verse</h1>
            
            <p class="text-slate-700 dark:text-slate-300 font-light text-lg leading-relaxed mb-8">
                An interactive literary journey exploring the profound themes of 
                <span class="font-medium text-indigo-700 dark:text-indigo-300">compassion</span> 
                in Gabriela Mistral's work and 
                <span class="font-medium text-rose-700 dark:text-rose-300">joy</span> 
                in Pablo Neruda's poetry.
            </p>

            <div class="mb-10 p-6 bg-white/60 dark:bg-black/20 rounded-xl">
                <p class="text-xs uppercase tracking-widest text-slate-600 dark:text-slate-400 mb-4 font-semibold">Curated By</p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm font-medium text-slate-800 dark:text-slate-200 mb-6">
                    <div>Mark June Almojuela</div>
                    <div>Kenneth Belardo</div>
                    <div>Mark Nelson Delavin</div>
                    <div>Precious Tibaijia</div>
                </div>
                
                <!-- Added CTA Message -->
                <p class="text-xs text-slate-600 dark:text-slate-400 mb-3 italic border-t border-slate-300 dark:border-slate-700 pt-4 font-medium">To submit your literary piece, contact us:</p>
                
                <div class="flex justify-center gap-6">
                    <a href="#" class="text-slate-500 hover:text-blue-700 transition-colors text-2xl"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="text-slate-500 hover:text-blue-600 transition-colors text-2xl"><i class="fab fa-facebook-messenger"></i></a>
                </div>
            </div>

            <button onclick="closeIntro()" class="group relative inline-flex items-center justify-center px-8 py-3 text-sm font-medium text-white transition-all duration-200 bg-indigo-700 rounded-full hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <span>Let the journey begin</span>
                <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
    </div>

    <!-- Read-Along Tutorial Modal (Appears once when toggled) -->
    <div id="read-tutorial-modal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm" onclick="closeReadTutorial()"></div>
        <div class="glass-panel relative z-10 w-full max-w-md rounded-2xl p-8 transform scale-95 transition-transform duration-300">
            <div class="text-center mb-6">
                <h3 class="serif-font text-2xl text-slate-900 dark:text-white mb-2">How to Read Along</h3>
                <p class="text-sm text-slate-600 dark:text-slate-400">Master the rhythm and emotion of the verse.</p>
            </div>
            
            <div class="space-y-6 mb-8">
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 rounded-full bg-pink-100 dark:bg-pink-900/30 flex items-center justify-center flex-shrink-0 text-pink-600 dark:text-pink-400">
                        <i class="fas fa-music"></i>
                    </div>
                    <div>
                        <p class="font-medium text-slate-800 dark:text-slate-200 mb-1">Performance Notes</p>
                        <p class="text-xs text-slate-600 dark:text-slate-400">Pink text like <span class="text-pink-600 dark:text-pink-500 text-xs font-bold">[SOFTLY]</span> indicates emotion, volume, or speed.</p>
                    </div>
                </div>
                
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center flex-shrink-0 text-amber-600 dark:text-amber-400">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div>
                        <p class="font-medium text-slate-800 dark:text-slate-200 mb-1">Stress & Emphasis</p>
                        <p class="text-xs text-slate-600 dark:text-slate-400">Words with a <span class="border-b-2 border-amber-500 font-bold">Gold Underline</span> should be spoken with weight and emphasis.</p>
                    </div>
                </div>

                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center flex-shrink-0 text-indigo-600 dark:text-indigo-400">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div>
                        <p class="font-medium text-slate-800 dark:text-slate-200 mb-1">Rhythm & Meter</p>
                        <p class="text-xs text-slate-600 dark:text-slate-400">Follow the line breaks and punctuation. Commas are short breaths; periods are full stops.</p>
                    </div>
                </div>
            </div>

            <button onclick="closeReadTutorial()" class="w-full py-2 bg-indigo-700 hover:bg-indigo-800 text-white rounded-lg text-sm font-medium transition-colors">
                Got it
            </button>
        </div>
    </div>

    <!-- About Us Modal (Triggered manually) -->
    <div id="about-modal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="toggleAbout()"></div>
        <div class="glass-panel relative z-10 w-full max-w-lg rounded-2xl p-8 transform scale-95 transition-transform duration-300">
            <button onclick="toggleAbout()" class="absolute top-4 right-4 text-slate-500 hover:text-slate-700 dark:hover:text-white transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
            <div class="text-center mb-8">
                <p class="text-xs uppercase tracking-[0.3em] text-indigo-800 dark:text-indigo-300 mb-2 opacity-90 font-semibold">The Curators</p>
                <h2 class="serif-font text-3xl text-slate-900 dark:text-white">Meet the Team</h2>
            </div>
            <div class="space-y-4 font-light text-center">
                <div class="p-3 hover:bg-white/50 dark:hover:bg-black/20 rounded-lg transition-colors"><p class="font-medium text-lg text-slate-800 dark:text-slate-100">MARK JUNE ALMOJUELA</p><p class="text-xs text-slate-600 dark:text-slate-400 uppercase tracking-widest mt-1">Researcher & Content</p></div>
                <div class="p-3 hover:bg-white/50 dark:hover:bg-black/20 rounded-lg transition-colors"><p class="font-medium text-lg text-slate-800 dark:text-slate-100">KENNETH BELARDO</p><p class="text-xs text-slate-600 dark:text-slate-400 uppercase tracking-widest mt-1">Design Lead</p></div>
                <div class="p-3 hover:bg-white/50 dark:hover:bg-black/20 rounded-lg transition-colors"><p class="font-medium text-lg text-slate-800 dark:text-slate-100">MARK NELSON DELAVIN</p><p class="text-xs text-slate-600 dark:text-slate-400 uppercase tracking-widest mt-1">Literary Analyst</p></div>
                <div class="p-3 hover:bg-white/50 dark:hover:bg-black/20 rounded-lg transition-colors"><p class="font-medium text-lg text-slate-800 dark:text-slate-100">PRECIOUS TIBAIJIA</p><p class="text-xs text-slate-600 dark:text-slate-400 uppercase tracking-widest mt-1">Project Manager</p></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="relative z-10 container mx-auto px-4 py-8 lg:py-12 max-w-6xl">
        
        <!-- Header -->
        <header class="text-center mb-10 fade-in flex flex-col items-center">
            <p class="text-xs uppercase tracking-[0.3em] text-indigo-900 dark:text-indigo-300 mb-3 opacity-90 font-semibold">Literary Archive Project</p>
            <h1 class="serif-font text-5xl md:text-7xl text-slate-900 dark:text-slate-100 mb-4 tracking-tight">Whispers of Verse</h1>
        </header>

        <!-- Control Panel -->
        <div class="flex flex-col lg:flex-row justify-center items-center gap-6 mb-12 fade-in" style="animation-delay: 0.2s;">
            <!-- Poem Selector -->
            <div class="glass-panel p-2 rounded-full flex gap-2">
                <button onclick="changePoem('tinyfeet')" id="btn-tinyfeet" class="px-6 py-2 rounded-full text-sm transition-all duration-300 font-medium">Tiny Feet</button>
                <button onclick="changePoem('laughter')" id="btn-laughter" class="px-6 py-2 rounded-full text-sm transition-all duration-300 font-medium">Your Laughter</button>
            </div>

            <!-- Mode Toggles -->
            <div class="flex flex-wrap justify-center gap-3">
                <!-- Journey Mode -->
                <div class="glass-panel px-4 py-2 rounded-full flex items-center gap-2 cursor-pointer group hover:bg-white/80 dark:hover:bg-slate-800/80 transition-all" onclick="toggleJourney()">
                    <div id="journey-indicator" class="w-3 h-3 rounded-full bg-slate-300 dark:bg-slate-600 transition-colors duration-300"></div>
                    <span class="text-xs uppercase tracking-wider font-semibold text-slate-700 dark:text-slate-300 group-hover:text-purple-700 dark:group-hover:text-purple-400">Journey</span>
                </div>

                <!-- Read-Along (New) -->
                <div class="glass-panel px-4 py-2 rounded-full flex items-center gap-2 cursor-pointer group hover:bg-white/80 dark:hover:bg-slate-800/80 transition-all" onclick="toggleReadAlong()">
                    <div id="read-indicator" class="w-3 h-3 rounded-full bg-slate-300 dark:bg-slate-600 transition-colors duration-300"></div>
                    <span class="text-xs uppercase tracking-wider font-semibold text-slate-700 dark:text-slate-300 group-hover:text-pink-700 dark:group-hover:text-pink-400">Read-Along</span>
                </div>

                <!-- Resonance -->
                <div class="glass-panel px-4 py-2 rounded-full flex items-center gap-2 cursor-pointer group hover:bg-white/80 dark:hover:bg-slate-800/80 transition-all" onclick="toggleResonance()">
                    <div id="resonance-indicator" class="w-3 h-3 rounded-full bg-slate-300 dark:bg-slate-600 transition-colors duration-300"></div>
                    <span class="text-xs uppercase tracking-wider font-semibold text-slate-700 dark:text-slate-300 group-hover:text-indigo-700 dark:group-hover:text-indigo-400">Resonance</span>
                </div>

                <!-- Context -->
                <div class="glass-panel px-4 py-2 rounded-full flex items-center gap-2 cursor-pointer group hover:bg-white/80 dark:hover:bg-slate-800/80 transition-all" onclick="toggleContext()">
                    <div id="context-indicator" class="w-3 h-3 rounded-full bg-slate-300 dark:bg-slate-600 transition-colors duration-300"></div>
                    <span class="text-xs uppercase tracking-wider font-semibold text-slate-700 dark:text-slate-300 group-hover:text-emerald-700 dark:group-hover:text-emerald-400">Context</span>
                </div>

                <!-- Dark Mode -->
                <button onclick="toggleTheme()" class="glass-panel w-9 h-9 rounded-full flex items-center justify-center text-slate-700 dark:text-slate-300 hover:text-indigo-700 dark:hover:text-indigo-400 transition-colors">
                    <i id="theme-icon" class="fas fa-moon"></i>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start fade-in" style="animation-delay: 0.4s;">
            <!-- Poem Section -->
            <section id="poem-container" class="lg:col-span-7 glass-panel rounded-3xl p-8 md:p-12 relative overflow-hidden min-h-[600px] flex flex-col justify-center">
                <div class="absolute top-0 right-0 p-6 opacity-10 pointer-events-none"><i class="fas fa-quote-right text-8xl text-slate-800 dark:text-white"></i></div>
                
                <div id="content-area" class="transition-opacity duration-500"></div>

                <!-- Journey Nav -->
                <div id="journey-controls" class="hidden mt-8 text-center text-slate-500 dark:text-slate-400 text-sm">
                    <p class="journey-nav-hint font-medium"><i class="fas fa-hand-pointer mr-2"></i>Click text to continue journey</p>
                    <div class="mt-4 flex justify-center gap-2" id="journey-dots"></div>
                </div>
            </section>

            <!-- Sidebar -->
            <aside class="lg:col-span-5 flex flex-col gap-6 relative">
                <!-- Analysis View -->
                <div id="view-analysis" class="flex flex-col gap-6 transition-all duration-500 opacity-100 transform translate-x-0">
                    <div class="glass-panel rounded-2xl p-8 border-l-4 border-indigo-400 dark:border-indigo-600">
                        <h3 class="text-xs uppercase tracking-widest text-slate-600 dark:text-slate-400 mb-4 font-bold">Database Entry</h3>
                        <div id="metadata-area"></div>
                    </div>
                    <div class="glass-panel rounded-2xl p-8">
                        <h3 class="text-xs uppercase tracking-widest text-slate-600 dark:text-slate-400 mb-4 font-bold">Literary Analysis</h3>
                        <div id="analysis-area" class="text-sm leading-relaxed text-slate-800 dark:text-slate-300"></div>
                    </div>
                    <div class="glass-panel rounded-2xl p-8">
                        <h3 class="text-xs uppercase tracking-widest text-slate-600 dark:text-slate-400 mb-4 font-bold">Emotional Palette</h3>
                        <div id="mood-area" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>

                <!-- Context View -->
                <div id="view-context" class="absolute inset-0 flex flex-col gap-4 transition-all duration-500 opacity-0 transform translate-x-10 pointer-events-none">
                    <div class="glass-panel rounded-2xl p-6 bg-white/90 dark:bg-slate-900/80 border-l-4 border-emerald-500 dark:border-emerald-600 h-full overflow-y-auto">
                        <div class="flex items-center gap-2 mb-6 text-emerald-800 dark:text-emerald-400">
                            <i class="fas fa-history"></i>
                            <h3 class="text-xs uppercase tracking-widest font-bold">Historical & Social Context</h3>
                        </div>
                        <div class="space-y-6">
                            <div><h4 class="font-serif text-lg text-slate-900 dark:text-slate-200 mb-2 font-semibold">Social Factors</h4><p id="ctx-social" class="text-sm text-slate-800 dark:text-slate-400 leading-relaxed"></p></div>
                            <hr class="border-slate-300 dark:border-slate-700">
                            <div><h4 class="font-serif text-lg text-slate-900 dark:text-slate-200 mb-2 font-semibold">Political Climate</h4><p id="ctx-political" class="text-sm text-slate-800 dark:text-slate-400 leading-relaxed"></p></div>
                            <hr class="border-slate-300 dark:border-slate-700">
                            <div><h4 class="font-serif text-lg text-slate-900 dark:text-slate-200 mb-2 font-semibold">Literary Movement</h4><p id="ctx-literary" class="text-sm text-slate-800 dark:text-slate-400 leading-relaxed"></p></div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>

        <footer class="mt-20 text-center pb-8">
            <button onclick="toggleAbout()" class="text-xs uppercase tracking-widest text-indigo-900/70 dark:text-indigo-300/60 hover:text-indigo-700 dark:hover:text-indigo-200 transition-colors mb-4 border-b border-dashed border-indigo-900/30 pb-1 font-semibold">About the Curators</button>
            <p class="text-slate-500 dark:text-slate-400 text-sm font-light">&copy; 2023 Literary Database Project.</p>
        </footer>
    </div>

    <script>
        // 1. THE DATABASE
        const poetryDB = {
            tinyfeet: {
                title: "Tiny Feet",
                originalTitle: "Los pies pequeñitos de los niños",
                author: "Gabriela Mistral",
                year: "1922",
                origin: "Chile",
                stanzas: [
                    { 
                        text: "Tiny feet of children,<br>Blue with <span class='highlight-word'>cold</span>,<br>How can they see you and not <span class='highlight-word'>cover</span> you?<br>Oh, God!", 
                        guide: "<span class='guide-note'>[Softly, with pity]</span> Tiny feet of children,<br><span class='stress-mark'>Blue</span> with <span class='highlight-word stress-mark'>cold</span>,<br><span class='guide-note'>[Rising intonation]</span> How can they <span class='stress-mark'>see</span> you and not <span class='highlight-word'>cover</span> you?<br><span class='guide-note'>[Pause]</span> Oh, God!",
                        mood: "mood-ice" 
                    },
                    { 
                        text: "Tiny <span class='highlight-word'>wounded</span> feet,<br>Bruised all over by <span class='highlight-word'>pebbles</span>,<br>Abused by <span class='highlight-word'>snow</span> and soil!", 
                        guide: "<span class='guide-note'>[Anguished]</span> Tiny <span class='highlight-word'>wounded</span> feet,<br>Bruised all over by <span class='highlight-word stress-mark'>pebbles</span>,<br><span class='guide-note'>[Sharp]</span> Abused by <span class='highlight-word'>snow</span> and soil!",
                        mood: "mood-pain" 
                    },
                    { 
                        text: "Man, being blind, ignores<br>that where you step, you leave<br>A <span class='highlight-word'>blossom</span> of bright light,<br>that where you have placed<br>your <span class='highlight-word'>bleeding</span> little soles<br>a red <span class='highlight-word'>tuberose</span> grows.", 
                        guide: "<span class='guide-note'>[Firmly]</span> Man, being <span class='stress-mark'>blind</span>, ignores<br>that where you step, you leave<br>A <span class='highlight-word'>blossom</span> of bright light,<br><span class='guide-note'>[Gently]</span> that where you have placed<br>your <span class='highlight-word'>bleeding</span> little soles<br>a red <span class='highlight-word'>tuberose</span> grows.",
                        mood: "mood-light" 
                    },
                    { 
                        text: "Since, however, you go through<br>the streets so straight,<br>you are <span class='highlight-word'>courageous</span>, faultless.", 
                        guide: "<span class='guide-note'>[With admiration]</span> Since, however, you go through<br>the streets so <span class='stress-mark'>straight</span>,<br>you are <span class='highlight-word'>courageous</span>, faultless.",
                        mood: "mood-void" 
                    },
                    { 
                        text: "Tiny feet of children,<br>Two tiny <span class='highlight-word'>suffering</span> gems,<br>How can the people pass you by<br>and not <span class='highlight-word'>see</span> you?", 
                        guide: "<span class='guide-note'>[Slowly, fading]</span> Tiny feet of children,<br>Two tiny <span class='highlight-word'>suffering</span> gems,<br><span class='guide-note'>[Desperate whisper]</span> How can the people pass you by<br>and not <span class='highlight-word stress-mark'>see</span> you?",
                        mood: "mood-ice" 
                    }
                ],
                themes: ["Suffering", "Innocence", "Social Neglect", "Compassion"],
                analysis: "Mistral uses the synecdoche of 'feet' to represent the vulnerable and impoverished children of society.",
                history: {
                    social: "Written during a time of immense rural poverty in Latin America. Child mortality rates were high.",
                    political: "The early 20th century in Chile saw a rigid class structure. Mistral's work gave a voice to the marginalized.",
                    literary: "Gabriela Mistral moved away from the ornate Modernismo style towards a simpler, more direct language."
                }
            },
            laughter: {
                title: "Your Laughter",
                originalTitle: "Tu Risa",
                author: "Pablo Neruda",
                year: "1952",
                origin: "Chile (Written in Exile)",
                stanzas: [
                    { 
                        text: "Take bread away from me, if you wish,<br>take air away, but<br>do not take from me your <span class='highlight-word'>laughter</span>.", 
                        guide: "<span class='guide-note'>[Boldly]</span> Take bread away from me, if you wish,<br>take air away, but<br><span class='guide-note'>[Tenderly]</span> do not take from me your <span class='highlight-word stress-mark'>laughter</span>.",
                        mood: "mood-deprivation" 
                    },
                    { 
                        text: "Do not take away the rose,<br>the lance flower that you pluck,<br>the water that suddenly<br>bursts in your <span class='highlight-word'>joy</span>,<br>the sudden wave of <span class='highlight-word'>silver</span><br>born in you.", 
                        guide: "Do not take away the <span class='stress-mark'>rose</span>,<br>the lance flower that you pluck,<br><span class='guide-note'>[Rapidly]</span> the water that suddenly<br>bursts in your <span class='highlight-word'>joy</span>,<br>the sudden wave of <span class='highlight-word'>silver</span><br>born in you.",
                        mood: "mood-silver" 
                    },
                    { 
                        text: "My struggle is <span class='highlight-word'>harsh</span> and I come back<br>with eyes tired<br>at times from seeing<br>the earth that does not change,<br>but when your laughter enters<br>it rises to the sky seeking me<br>and it opens for me all<br>the doors of <span class='highlight-word'>life</span>.", 
                        guide: "<span class='guide-note'>[Weary tone]</span> My struggle is <span class='highlight-word'>harsh</span> and I come back<br>with eyes tired...<br><span class='guide-note'>[Hopeful shift]</span> but when your laughter enters<br>it rises to the sky seeking me<br>and it opens for me all<br>the doors of <span class='highlight-word stress-mark'>life</span>.",
                        mood: "mood-light" 
                    },
                    { 
                        text: "Laugh at the night,<br>at the day, at the moon,<br>laugh at the twisted<br>streets of the island,<br>laugh at this clumsy<br>boy who <span class='highlight-word'>loves</span> you,<br>but when I open my eyes and close them,<br>when my steps go,<br>when my steps return,<br>deny me bread, air,<br>light, spring,<br>but never your <span class='highlight-word'>laughter</span><br>for I would <span class='highlight-word'>die</span>.", 
                        guide: "<span class='guide-note'>[Joyfully]</span> Laugh at the night,<br>at the day, at the moon...<br><span class='guide-note'>[Slow down, serious]</span> but never your <span class='highlight-word'>laughter</span><br><span class='guide-note'>[Whisper]</span> for I would <span class='highlight-word stress-mark'>die</span>.",
                        mood: "mood-love" 
                    }
                ],
                themes: ["Love", "Resilience", "Hope", "Vitality"],
                analysis: "Neruda portrays laughter not just as an expression of happiness, but as a life-sustaining force essential for survival amidst struggle.",
                history: {
                    social: "Dedicated to Matilde Urrutia, Neruda's secret lover at the time.",
                    political: "Written while Neruda was in exile in Capri, Italy, due to his Communist party affiliation.",
                    literary: "Part of 'The Captain's Verses'. Intimate, elemental love poetry."
                }
            }
        };

        let currentPoem = 'tinyfeet';
        let journeyIndex = 0;
        let isResonanceMode = false;
        let isContextMode = false;
        let isJourneyMode = false;
        let isReadAlongMode = false;

        // 2. MODAL LOGIC
        window.onload = function() {
            if(!sessionStorage.getItem('introShown')) {
                document.getElementById('intro-modal').classList.add('modal-open');
                const content = document.querySelector('#intro-modal .glass-panel');
                content.classList.remove('scale-95'); content.classList.add('scale-100');
            }
        }

        function closeIntro() {
            const modal = document.getElementById('intro-modal');
            modal.classList.remove('modal-open');
            sessionStorage.setItem('introShown', 'true');
            // DEFAULT TO TINY FEET
            changePoem('tinyfeet');
        }

        function toggleAbout() {
            const modal = document.getElementById('about-modal');
            const content = modal.querySelector('div.glass-panel');
            if (modal.classList.contains('modal-open')) {
                modal.classList.remove('modal-open');
                content.classList.remove('scale-100'); content.classList.add('scale-95');
            } else {
                modal.classList.add('modal-open');
                content.classList.remove('scale-95'); content.classList.add('scale-100');
            }
        }

        function closeReadTutorial() {
            const modal = document.getElementById('read-tutorial-modal');
            const content = modal.querySelector('div.glass-panel');
            modal.classList.remove('modal-open');
            content.classList.remove('scale-100'); content.classList.add('scale-95');
        }

        // 3. RENDER LOGIC
        function changePoem(poemKey) {
            currentPoem = poemKey;
            journeyIndex = 0;
            loadPoem();
            updateButtonStyles();
            // Pass the first mood to generateAnimation for correct speed/style
            const firstMood = poetryDB[poemKey].stanzas[0].mood;
            generateAnimation(poemKey === 'tinyfeet' ? 'feet' : 'laughter', firstMood);
        }

        function loadPoem() {
            const data = poetryDB[currentPoem];
            const contentArea = document.getElementById('content-area');
            const journeyControls = document.getElementById('journey-controls');
            
            contentArea.style.opacity = '0';
            
            setTimeout(() => {
                let html = `
                    <h2 class="serif-font text-4xl mb-2 text-indigo-900 dark:text-indigo-300 text-center md:text-left">${data.title}</h2>
                    <h3 class="serif-font text-xl italic text-slate-500 dark:text-slate-400 mb-8 border-b border-indigo-200 dark:border-indigo-900 pb-4 text-center md:text-left font-medium">${data.originalTitle}</h3>
                `;

                if (isJourneyMode) {
                    const stanza = data.stanzas[journeyIndex];
                    let textToRender = isReadAlongMode && stanza.guide ? stanza.guide : stanza.text;

                    html += `
                        <div onclick="nextStanza()" class="journey-card py-12 px-4 rounded-xl border border-white/20 shadow-sm bg-white/40 dark:bg-black/20 text-center">
                            <div class="poem-text serif-font text-2xl md:text-3xl leading-loose text-slate-900 dark:text-slate-100 ${isResonanceMode ? 'resonance-active' : ''}">
                                ${textToRender}
                            </div>
                        </div>
                    `;
                    updateBackground(stanza.mood);
                    journeyControls.classList.remove('hidden');
                    renderJourneyDots(data.stanzas.length);
                    // Update animation based on new mood (walking speed/style)
                    if(currentPoem === 'tinyfeet') generateAnimation('feet', stanza.mood);
                    
                } else {
                    html += `<div class="poem-text serif-font text-xl leading-loose text-slate-900 dark:text-slate-200 ${isResonanceMode ? 'resonance-active' : ''}">`;
                    data.stanzas.forEach(stanza => {
                        let textToRender = isReadAlongMode && stanza.guide ? stanza.guide : stanza.text;
                        html += `<p class="mb-6">${textToRender}</p>`;
                    });
                    html += `</div>`;
                    updateBackground('ambient-default');
                    journeyControls.classList.add('hidden');
                    // Reset animation to default for poem type
                    generateAnimation(currentPoem === 'tinyfeet' ? 'feet' : 'laughter');
                }

                contentArea.innerHTML = html;
                
                document.getElementById('metadata-area').innerHTML = `
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><p class="text-slate-600 dark:text-slate-400 text-xs font-medium">Author</p><p class="font-bold text-slate-900 dark:text-slate-200">${data.author}</p></div>
                        <div><p class="text-slate-600 dark:text-slate-400 text-xs font-medium">Year</p><p class="font-bold text-slate-900 dark:text-slate-200">${data.year}</p></div>
                        <div><p class="text-slate-600 dark:text-slate-400 text-xs font-medium">Origin</p><p class="font-bold text-slate-900 dark:text-slate-200">${data.origin}</p></div>
                    </div>`;
                
                document.getElementById('analysis-area').innerText = data.analysis;
                document.getElementById('mood-area').innerHTML = data.themes.map(theme => 
                    `<span class="px-3 py-1 bg-white/60 dark:bg-slate-700/50 rounded-md text-xs font-bold uppercase tracking-wider text-indigo-900 dark:text-indigo-200 border border-indigo-200 dark:border-indigo-900 shadow-sm">${theme}</span>`
                ).join('');

                document.getElementById('ctx-social').innerText = data.history.social;
                document.getElementById('ctx-political').innerText = data.history.political;
                document.getElementById('ctx-literary').innerText = data.history.literary;

                contentArea.style.opacity = '1';
                
            }, 300);
        }

        function nextStanza() {
            if (!isJourneyMode) return;
            const maxIndex = poetryDB[currentPoem].stanzas.length - 1;
            if (journeyIndex < maxIndex) journeyIndex++;
            else journeyIndex = 0;
            loadPoem();
        }

        function renderJourneyDots(count) {
            const container = document.getElementById('journey-dots');
            let dotsHtml = '';
            for(let i=0; i<count; i++) {
                let opacity = i === journeyIndex ? 'bg-slate-900 dark:bg-white scale-125' : 'bg-slate-400 dark:bg-slate-600';
                dotsHtml += `<div class="w-2 h-2 rounded-full transition-all duration-300 ${opacity}"></div>`;
            }
            container.innerHTML = dotsHtml;
        }

        function updateBackground(moodClass) {
            const body = document.getElementById('main-body');
            body.className = `min-h-screen text-slate-900 dark:text-slate-200 overflow-x-hidden selection:bg-indigo-100 dark:selection:bg-indigo-900 selection:text-indigo-800 dark:selection:text-indigo-200 ${moodClass}`;
        }

        // 4. TOGGLES
        function toggleJourney() {
            isJourneyMode = !isJourneyMode;
            journeyIndex = 0;
            updateToggleUI('journey', isJourneyMode, 'bg-purple-700');
            loadPoem();
        }

        function toggleReadAlong() {
            isReadAlongMode = !isReadAlongMode;
            updateToggleUI('read', isReadAlongMode, 'bg-pink-700');
            
            // SHOW TUTORIAL ONCE
            if(isReadAlongMode && !sessionStorage.getItem('readTutorialShown')) {
                sessionStorage.setItem('readTutorialShown', 'true');
                const modal = document.getElementById('read-tutorial-modal');
                const content = modal.querySelector('div.glass-panel');
                modal.classList.add('modal-open');
                content.classList.remove('scale-95'); content.classList.add('scale-100');
            }
            
            loadPoem();
        }

        function toggleResonance() {
            isResonanceMode = !isResonanceMode;
            updateToggleUI('resonance', isResonanceMode, 'bg-indigo-700');
            loadPoem(); 
        }

        function toggleContext() {
            isContextMode = !isContextMode;
            updateToggleUI('context', isContextMode, 'bg-emerald-600');
            const viewAnalysis = document.getElementById('view-analysis');
            const viewContext = document.getElementById('view-context');
            if (isContextMode) {
                viewAnalysis.style.opacity = '0'; viewAnalysis.style.transform = 'translateX(-20px)'; viewAnalysis.style.pointerEvents = 'none';
                viewContext.style.opacity = '1'; viewContext.style.transform = 'translateX(0)'; viewContext.style.pointerEvents = 'auto';
            } else {
                viewAnalysis.style.opacity = '1'; viewAnalysis.style.transform = 'translateX(0)'; viewAnalysis.style.pointerEvents = 'auto';
                viewContext.style.opacity = '0'; viewContext.style.transform = 'translateX(10px)'; viewContext.style.pointerEvents = 'none';
            }
        }

        function updateToggleUI(idPrefix, isActive, activeClass) {
            const indicator = document.getElementById(idPrefix + '-indicator');
            if (isActive) {
                indicator.classList.remove('bg-slate-300', 'dark:bg-slate-600');
                indicator.classList.add(activeClass.replace('bg-', 'bg-'), 'dark:' + activeClass); 
                indicator.className = `w-3 h-3 rounded-full transition-colors duration-300 ${activeClass} dark:${activeClass.replace('700', '400')}`;
            } else {
                indicator.className = 'w-3 h-3 rounded-full bg-slate-300 dark:bg-slate-600 transition-colors duration-300';
            }
        }

        function updateButtonStyles() {
            const btnTiny = document.getElementById('btn-tinyfeet');
            const btnLaugh = document.getElementById('btn-laughter');
            if(currentPoem === 'tinyfeet') {
                btnTiny.className = "px-6 py-2 rounded-full text-sm transition-all duration-300 bg-white dark:bg-slate-700 shadow-sm text-indigo-900 dark:text-white font-medium transform scale-105";
                btnLaugh.className = "px-6 py-2 rounded-full text-sm transition-all duration-300 hover:bg-white/50 dark:hover:bg-slate-700/50 text-slate-700 dark:text-slate-400";
            } else {
                btnLaugh.className = "px-6 py-2 rounded-full text-sm transition-all duration-300 bg-white dark:bg-slate-700 shadow-sm text-indigo-900 dark:text-white font-medium transform scale-105";
                btnTiny.className = "px-6 py-2 rounded-full text-sm transition-all duration-300 hover:bg-white/50 dark:hover:bg-slate-700/50 text-slate-700 dark:text-slate-400";
            }
        }

        function toggleTheme() {
            const body = document.documentElement;
            const icon = document.getElementById('theme-icon');
            if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                icon.classList.remove('fa-sun'); icon.classList.add('fa-moon');
            } else {
                body.classList.add('dark');
                icon.classList.remove('fa-moon'); icon.classList.add('fa-sun');
            }
        }

        // 5. TRAIL ANIMATION LOGIC
        function generateAnimation(type, mood) {
            const container = document.getElementById('anim-layer');
            container.innerHTML = ''; 
            const count = 12; // Number of items

            for (let i = 0; i < count; i++) {
                const el = document.createElement('i');
                el.classList.add('anim-icon', 'fas');
                
                // Base speed calc
                let speedFactor = 1.0;
                if(mood === 'mood-pain' || mood === 'mood-ice') speedFactor = 1.5; // Slower/Heavier
                if(mood === 'mood-light') speedFactor = 0.8; // Faster/Lighter

                if (type === 'feet') {
                    el.classList.add('fa-shoe-prints', 'anim-footprint');
                    
                    // --- REALISTIC TRAIL LOGIC ---
                    const progress = i / count; 
                    
                    // Curve Logic (Sine wave path from left to right-ish)
                    const pathCenter = 20 + (progress * 60); // Moves from 20% left to 80% right
                    const curve = Math.sin(progress * Math.PI) * 10; // Adds a gentle arc
                    
                    // Stagger: Left foot is Left of center, Right foot is Right of center
                    const isLeftFoot = i % 2 === 0;
                    const stepWidth = 4; // Width between feet
                    const x = pathCenter + curve + (isLeftFoot ? -stepWidth : stepWidth);
                    
                    // Rotation: Left foot angles left (-15deg), Right foot angles right (15deg)
                    // Add progress rotation to follow the curve
                    const baseRotation = isLeftFoot ? -15 : 15;
                    const pathRotation = 45; // General diagonal direction
                    
                    el.style.left = `${x}%`;
                    el.style.bottom = `${progress * 90}%`;
                    el.style.transform = `rotate(${pathRotation + baseRotation}deg)`;
                    
                    // Sequential timing
                    el.style.animationDelay = `${(i * 0.8) * speedFactor}s`;
                    el.style.animationDuration = `${8 * speedFactor}s`;
                    
                } else {
                    // Sparkles (Laughter)
                    el.classList.add(Math.random() > 0.5 ? 'fa-sun' : 'fa-star', 'anim-sparkle');
                    el.style.left = (Math.random() * 90) + '%';
                    el.style.animationDelay = (Math.random() * 5) + 's';
                    el.style.fontSize = (1 + Math.random()) + 'rem';
                }
                
                container.appendChild(el);
            }
        }
    </script>
</body>
</html>